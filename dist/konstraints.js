// Generated by CoffeeScript 1.10.0
(function() {
  var checkRule, flatten, konstraints, ref, resultsLogger;

  ref = require('./utils'), flatten = ref.flatten, resultsLogger = ref.resultsLogger;

  checkRule = require('./checkrule');

  module.exports = konstraints = function(target, rules, options) {
    var i, j, len, len1, passed, result, results, rule, ruleResults;
    passed = true;
    results = [];
    if (options == null) {
      options = {};
    }
    if (options.log == null) {
      options.log = false;
    }
    if (options.logDefaults == null) {
      options.logDefaults = false;
    }
    if (options.checkAll == null) {
      options.checkAll = false;
    }
    for (i = 0, len = rules.length; i < len; i++) {
      rule = rules[i];
      ruleResults = checkRule(rule, target);
      if (Array.isArray(ruleResults[0][0])) {
        ruleResults = flatten(ruleResults);
      }
      for (j = 0, len1 = ruleResults.length; j < len1; j++) {
        result = ruleResults[j];
        results.push(result);
        if (!result[0]) {
          passed = false;
          if (!options.checkAll) {
            break;
          }
        }
      }
      if (!passed && !options.checkAll) {
        break;
      }
    }
    if (options.log) {
      resultsLogger({
        passed: passed,
        results: results
      }, options);
    }
    return {
      passed: passed,
      results: results
    };
  };

}).call(this);
